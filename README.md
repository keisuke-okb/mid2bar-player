# MID2BAR-Player

A standalone karaoke player that generates karaoke subtitle videos using ruby-annotated LRC lyric files, melody MIDI data, and background videos.

## 概要

- **MID2BAR-Player**: MIDIのメロディ情報とLRC（ルビ対応）歌詞、任意の背景動画／音声を組み合わせてカラオケ表示・可視化するスタンドアロンプレイヤーです。
- **主な機能**: 譜割り（区切り）を作成したメロディーMIDIファイルと歌詞と同期表示、表示エフェクト（ノートバー、グロー、パーティクル）、マイク入力によるリアルタイム採点（実際のカラオケ機器のものとは異なり、音程の一致度のみを算出しています。参考程度とお考え下さい。）、映像の重ね合わせ、録画（エクスポート）機能。


### 動作環境

- OS: Windows 11
- ディスプレイ：Full HD(1920x1080)以上の解像度


## 使い方（ビルド済みパッケージ）

1. `MID2BAR-Player.exe` を起動します。
2. 起動後、画面上のファイル選択ダイアログから以下のファイルを読み込みます（UIの指示に従ってください）：
	- 音声ファイル（例: WAV / MP3など）
	- MIDIファイル（.mid）
	- 歌詞ファイル（LRC, 拡張ルビ形式）
	- 背景動画（任意）
3. 読み込みが完了すると、歌詞のプレビュー生成など初期処理が行われます（生成中はメッセージが表示されます）。
4. 表示が準備できたらスペースキーで再生を開始します。


## 基本操作（キーボード・マウス）

- **Space**: 再生 / 一時停止
- **R**: 再スタート（先頭から再生）
- **A**: 小節の自動再生（Bar Auto Play）ON/OFF
- **M**: マイク入力（リアルタイム採点）ON/OFF
- **F11**: フルスクリーン切替
- **↑ / ↓**: 音量調整
- **ESC**: 終了
- **マウス左クリック**: メニューの表示、再生位置をシーク（シークバー上）


## 録画（動画出力）

- `ffmpeg`を利用して、プレイヤーの映像をMP4動画として書き出すことができます。
- 録画を有効にして起動すると、再生中の映像と音声を合成して動画出力できます。
- 録画中は、画面を操作しないでください。


## トラブルシューティング

- 音が出ない場合: システムの音量、Pygameが使用するオーディオデバイス、ファイル形式を確認してください。
- マイクが反応しない場合: マイクがシステムで有効か、アプリにマイク許可があるかを確認してください。


## マイク入力とリアルタイム採点（参考程度の機能）

- 設定でマイク入力をONにして起動するか、再生中に `M` でマイク入力を有効にすると、FFTベースのピッチ検出により歌声を解析してノートとの一致度やピッチ精度をページ単位で算出します。
- マイク入力の閾値や遅延補正などのパラメータは設定ファイル（`app_settings/settings.json`）で調整できます。


## ライセンス

- リポジトリに含まれる各種ファイルのうち、別途ファイル名にライセンスが明記されていないファイルはすべてリポジトリの `LICENSE` に基づきます。
- `sample/`に含まれるサンプル音楽の著作権は[森田交一（魔王魂）](https://maou.audio/)に帰属します。
- 本リポジトリのプログラム（改変含む）またはビルド済みパッケージを利用して作成した動画を動画投稿サイトにアップロードすることが可能です。その際は、使用したソフトウェアとして「MID2BAR-Player」と表記をお願いいたします。また、作成した動画のアップロードによって生じた問題についてはいかなる責任を負いかねますのでご注意ください。

